# Headshot: One Strike, Vulnerability Scanning for Designated URLs in Batches

## 0x01 Overview

In a real attack and defense scenario, we discovered an address with a Struts2 vulnerability in a subdirectory obtained through Fuzz, which made it impossible for Goby's crawler to reach this page. However, using other Struts2 scanning tools, we found that the address did have a remote code execution vulnerability. After analyzing, Goby's PoC was also able to detect this vulnerability, but it faced an awkward situation — even though we knew the URL was vulnerable and had a working PoC, we couldn't get Goby to detect the vulnerability.

## 0x02 Smooth Struts Vulnerability Detection

This problem was really bothering me, so I decided to solve it by developing a plugin called Headshot. It allows users to input URLs and select custom PoCs, making it easier to conduct real-world penetration testing and exploitation. With this plugin, we can now use Goby more flexibly to deal with scenarios like Struts2 vulnerabilities. Although the appearance of the final plugin is unremarkable, it has made the entire process much smoother.

[![struts2](https://i.ytimg.com/vi/hru4HnvmdvE/maxresdefault.jpg)](https://youtu.be/hru4HnvmdvE "struts2")

If you want to experience it yourself, Vulfocus (https://vulfocus.cn) has a comprehensive Struts2 vulnerability lab that you can try out.

[![pCCz9l6.png](https://s1.ax1x.com/2023/06/05/pCCz9l6.png)](https://imgse.com/i/pCCz9l6)

You can choose to demo the code execution vulnerability (CVE-2007-4556) of Struts2 by selecting the "struts-s2-001" lab on Vulfocus. When you click the "Submit" button, the page will show obvious Struts2 characteristics：

[![pCPS1v6.png](https://s1.ax1x.com/2023/06/05/pCPS1v6.png)](https://imgse.com/i/pCPS1v6)

Struts2 vulnerabilities are a classic type of vulnerability in real attack and defense scenarios. They are easy to exploit, have high impact, and are widespread. Moreover, they have easily recognizable features. Generally, during the information-gathering process, if we find links on the page with extensions like ".action" or ".do", it's highly likely that the target is using the Struts2 framework. At this point, we can use Headshot for quick detection.

[![pCPSJbD.png](https://s1.ax1x.com/2023/06/05/pCPSJbD.png)](https://imgse.com/i/pCPSJbD)

## 0x03 Customize the URL address

In some cases, when you access a target port, you may receive an Apache 403 error page (as shown in the figure), with no other valid fingerprint features. However, when we enter the "oa" directory (don't ask me how I knew about this directory), we can access the real business system. This is especially common in some enterprise business systems. In this case, the original version of Goby cannot detect the target because it is impossible to customize the directory when setting up the scan task.

[![pCPSw8I.png](https://s1.ax1x.com/2023/06/05/pCPSw8I.png)](https://imgse.com/i/pCPSw8I)

[![pCPSrKf.png](https://s1.ax1x.com/2023/06/05/pCPSrKf.png)](https://imgse.com/i/pCPSrKf)

Now, you can easily use Headshot to conduct detection on the target (video is not accelerated throughout):

[![thinkphp](https://i.ytimg.com/vi/gG8pQ5_vy8Q/maxresdefault.jpg)](https://youtu.be/gG8pQ5_vy8Q "thinkphp")

Batch and rapid vulnerability detection.
When conducting penetration testing, experienced attackers need to save time and rely on their instincts. For example, when we already know that the target is using WebLogic or popular OA systems like WPS and ZYOA, we only want to quickly check for high-risk vulnerabilities that have appeared in the target's history. This becomes especially easy with Headshot.

[![weblogic](https://i.ytimg.com/vi/mK2tIjPKiyQ/maxresdefault.jpg)](https://youtu.be/mK2tIjPKiyQ "weblogic")

## 0x04 Future

Headshot is an attempt by Goby to expand its plugin functionality. Previous plugins could only modify the input and output of Goby's main process, such as FOFA (extracting scan targets from FOFA and inputting them into Goby for scanning), ShellHub (extracting webshells from Goby's exploitation results for webshell management), TaskQueue (setting up scheduled tasks and task queues that are input to Goby for scanning), etc. But Headshot is different. It separates vulnerability detection and exploitation and no longer relies on Goby's main process. To achieve this, I utilized three APIs that Goby has opened to external developers:

- goby.debugPoc checks if the target has a vulnerability and returns the interactive data packet used for validation as well as the validation result.
- goby.openExp opens the verification interface for the corresponding Exp.
- goby.getPocSearch searches for PoCs based on specified conditions and returns a list of search results.

By combining and assembling these three APIs, we created Headshot. In fact, there are many other things that can be done using these APIs, such as developing specialized scanning tools for specific types of vulnerabilities or creating a one-click vulnerability exploitation tool. These APIs can also be used to supplement other vulnerability scanning tools. If you have great ideas and want to develop a unique Goby plugin, you can learn more about Goby extensions on the Goby official website, where you will find detailed development documentation. You are also welcome to join our official community to discuss plugin development with us. Goby will continue to open up more capabilities so that users can use Goby to do cooler things.

Finally, everyone can experience Headshot by downloading it in one click from the extensions section of the Goby client (see the video tutorial below). Respect~

[![headshot](https://i.ytimg.com/vi/ejWLY1gjD1E/maxresdefault.jpg)](https://youtu.be/ejWLY1gjD1E "headshot")

Goby (https://gobies.net)
Vulfocus (https://vulfocus.cn)
Goby-Doc (https://gobies.net/doc)
Goby-Extensions (https://gobies.net/extensions)

Plugin development documentation:
https://gobies.org/doc

<br/>

<br/>
[Goby Official URL](https://gobies.org/)

If you have a functional type of issue, you can raise an issue on GitHub or in the discussion group below:

1. GitHub issue: https://github.com/gobysec/Goby/issues
2. Telegram Group: http://t.me/gobies (Community advantage: Stay updated with the latest information about Goby features, events, and other announcements in real-time.) 
3. Telegram Channel: https://t.me/joinchat/ENkApMqOonRhZjFl 
4. Twitter：[https://twitter.com/GobySec](https://twitter.com/GobySec)

